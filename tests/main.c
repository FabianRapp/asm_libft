#include <stdio.h>
#include <ctype.h>
#include <assert.h>
#include <libft.h>
#include <stdbool.h>
#include <string.h>
#include <limits.h>

char *test_strs[] = {
	"1",
	"11",
	"111",
	"1111",
	"11111",
	"111111",
	"1111111",
	"11111111",
	"111111111",
	"1111111111",
	"11111111111",
	"111111111111",
	"1111111111111",
	"11111111111111",
	"111111111111111",
	"1111111111111111",
	"11111111111111111",
	"111111111111111111",
	"1111111111111111111",
	"11111111111111111111",
	"111111111111111111111",
	"1111111111111111111111",
	"11111111111111111111111",
	"111111111111111111111111",
	"1111111111111111111111111",
	"11111111111111111111111111",
	"111111111111111111111111111",
	"1111111111111111111111111111",
	"11111111111111111111111111111",
	"111111111111111111111111111111",
	"1111111111111111111111111111111",
	"11111111111111111111111111111111",
	"111111111111111111111111111111111",
	"1111111111111111111111111111111111",
	"11111111111111111111111111111111111",
	"111111111111111111111111111111111111",
	"1111111111111111111111111111111111111",
	"11111111111111111111111111111111111111",
	"111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
	"111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111",
    "!",
    "Hello, world!",
    "OpenAI GPT",
    "C programming is fun",
    "C programminC programming is fun programming is funC programming is fung is fun",
    "Sample string",
    "Another example",
    "Yet another string",
    "Test case 1",
    "Test case 2",
    "Random text",
    "End of array",
    "",
	"1234567",
	"12345678",
	"123456789012345",
	"1234567890123456",
	"12345678901234567",
	"12345678901234567890",
	"1234567890123456789",
	"123456789012345678901",
	"123456789012345678901234567890",
	"1234567890123456789012345678901234567890",
	"123456789012345678901234567890123456789",
	"12345678901234567890123456789012345678",
	"12345678901234567890123456789012345678901",
	"123456789012345678901234567890123456789012",
	"oH{!g?!dJ0=6YcwDie>M1oFbZN B0)p;Q)=TI>",
	"zyxwvutsrqponm\0lkjihgfedcba",
};

#ifndef PRINT_PASS
# define PRINT_PASS false
#endif //PRINT_PASS

//to hopfully fill the registers with trash
#ifndef DO_RANDOM_STUFF
# define DO_RANDOM_STUFF \
	do { \
		const size_t s = 100; \
		volatile long long buf[s]; \
		for (size_t i = 0; i < 1000; i++) { \
			buf[i % s] = buf[s - (i % s) - 1]; \
		}\
	} while (0)
#endif //DO_RANDOM_STUFF

#ifndef CMP_RESULT
# define CMP_RESULT(fn, expect, actual, i, printf_type) \
	if ((expect) != (actual)) { \
		fprintf(stderr, "Fail: " #fn ": for value %" #printf_type " (0x%08x)"\
			": expected: %" #printf_type " actual: %" #printf_type "\n", \
			i, (unsigned)i, expect, actual); \
		fail = true; \
	} \
	else if (PRINT_PASS) { \
		fprintf(stderr, "Pass: " #fn ": for value %" #printf_type " (0x%08x)"\
			": expected: %" #printf_type " actual: %" #printf_type "\n", \
				i, (unsigned)i, expect, actual); \
	}
#endif // CMP_RESULT

#ifndef TEST_CHAR_FN
# define TEST_CHAR_FN(fn) \
{ \
	bool	fail = false; \
 \
	for (int i = EOF; i < 256; i++) { \
		int	expect = !!fn((unsigned char)i); \
		int	actual = !!ft_##fn((unsigned char)i); \
		CMP_RESULT(fn, expect, actual, i, d); \
	}\
	if (!fail) { \
		printf(#fn " passed!\n"); \
	} \
}
#endif //TEST_CHAR_FN

#ifndef TEST_1STR_FN
# define TEST_1STR_FN(fn) \
{ \
	bool	fail = false; \
	for (size_t i = 0; i < sizeof test_strs / sizeof test_strs[0]; i++) { \
		size_t	expect = fn(test_strs[i]); \
		DO_RANDOM_STUFF; \
		size_t	actual = ft_##fn(test_strs[i]); \
		CMP_RESULT(fn, expect, actual, i, lu); \
	} \
	if (!fail) { \
		printf(#fn " passed!\n"); \
	} \
}
#endif // TEST_1STR_FN

bool	can_print_return(char *str_fn) {
	//add more when needed for debugging
	if (!strcmp(str_fn, "memcpy") || !strcmp(str_fn, "strlcpy")
		|| !strcmp(str_fn, "memmove")) {
		return (true);
	}
	return (false);
}

#ifndef CMP_BUF_RESULTS
# define CMP_BUF_RESULTS(fn, expect, actual, size) \
{\
	if (!can_print_return(#fn) && memcmp(expect, actual, size)) { \
		fprintf(stderr, "|%s| Fail: " #fn "\n", cur); \
		fail = true; \
	} else if (memcmp(expect, actual, size)) { \
		fprintf(stderr, "|%s| Fail: " #fn ": |%s|\n", cur, (char *)actual); \
		fail = true; \
	} else if (PRINT_PASS) { \
		fprintf(stderr, "Pass: " #fn "\n"); \
	} \
}
#endif // CMP_BUF_RESULTS


#ifndef TEST_BUF_FN
# define TEST_BUF_FN(fn, ...) \
{ \
	for (size_t i = 0; i < sizeof test_strs / sizeof test_strs[0]; i++) { \
		char	*cur = test_strs[i]; \
		void	*expect = strdup(cur); \
		void	*actual = strdup(cur); \
		for (size_t i = 0; i < strlen(cur); i++) { \
			((char *)expect)[i] = i;\
			((char *)actual)[i] = i;\
		} \
		fn(expect, __VA_ARGS__); \
		DO_RANDOM_STUFF; \
		ft_##fn(actual, __VA_ARGS__); \
		CMP_BUF_RESULTS(fn, expect, actual, strlen(cur)); \
		free(expect); \
		free(actual); \
	}\
}
#endif //TEST_1BUF_FN

void	test_memset(void) {
	bool	fail = false;
	for (int i = -300; i <= 300; i++ ) {
		TEST_BUF_FN(memset, i, strlen(cur));
	}

	TEST_BUF_FN(memset, INT_MAX, strlen(cur));
	TEST_BUF_FN(memset, INT_MIN, strlen(cur));
	for (size_t i = 0; i < sizeof test_strs / sizeof test_strs[0]; i++) {
		char	*test = strdup(test_strs[i]);
		if (ft_memset(test, i, strlen(test_strs[i])) != test) {
			printf("ft_meset failed: return val\n");
			fail = true;
		}
		free(test);
	}
	if (!fail)
		printf("memset passed\n");
}

void	test_memcpy(void) {
	bool	fail = false;
	TEST_BUF_FN(memcpy, cur, strlen(cur));
	TEST_BUF_FN(memmove, cur, strlen(cur));
	for (size_t i = 0; i < sizeof test_strs / sizeof test_strs[0]; i++) {
		char	*test = calloc(strlen(test_strs[i]) + 1, 1);
		if (ft_memcpy(test, test_strs[i], strlen(test_strs[i]) + 1) != test) {
			printf("ft_memcpy failed: return val\n");
			fail = true;
		}
		free(test);
	}
	if (!fail)
		printf("memcpy/memmove passed\n");
}

int main(void) {
	//printf("sizeof size_t: %lu\n", sizeof(size_t));
	TEST_CHAR_FN(isalpha);
	TEST_CHAR_FN(isdigit);
	TEST_CHAR_FN(isalnum);
	TEST_CHAR_FN(isascii);
	TEST_CHAR_FN(isprint);
	TEST_1STR_FN(strlen);

	bool	fail = false;
	TEST_BUF_FN(bzero, strlen(cur));
	if (!fail)
		printf("bzero passed\n");
	test_memset();
	test_memcpy();
	fail = false;
	TEST_BUF_FN(strlcpy, cur, strlen(cur));
	if (!fail)
		printf("strlcpy passed\n");
	return (0);
}
